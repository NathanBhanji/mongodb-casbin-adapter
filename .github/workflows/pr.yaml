name: ğŸ“ PR Checks

on:
  pull_request:
    branches: [main]

jobs:
  tests:
    name: ğŸ§ª Tests
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Environment
        uses: ./.github/actions/setup

      - name: ğŸ§‘â€ğŸ”¬ Run tests and upload coverage
        uses: ./.github/actions/test
        with:
          codecov-token: ${{ secrets.CODECOV_TOKEN }}

  linting:
    name: ğŸ“ Lint
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Environment
        uses: ./.github/actions/setup

      - name: ğŸ“ Lint
        run: yarn lint

  formatting:
    name: âœ¨ Formatting
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Environment
        uses: ./.github/actions/setup

      - name: ğŸ§‘â€ğŸ”¬ Check formatting
        run: yarn format:check

  build:
    name: ğŸ—ï¸ Build
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›’ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Environment
        uses: ./.github/actions/setup

      - name: ğŸ‘· Build package
        run: yarn build

  checks-completed:
    name: âœ… Checks Completed
    runs-on: ubuntu-latest
    needs: [tests, linting, formatting, build]
    if: always()
    steps:
      - name: ğŸ‰ All checks passed
        run: echo "All required checks have passed!"

      - name: ğŸš¨ PR checks failed
        if: contains(needs.*.result, 'failure') || contains(needs.*.result, 'cancelled')
        run: |
          echo "PR checks failed"
          exit 1
